import{W as Z}from"./md-editor-v3-0a0b1d03.js";import{_ as ee}from"./SelectFile-d0dfd641.js";import{a as ae,u as te}from"./vue-router-c96a8d72.js";import{_ as le,r as oe}from"./index-60949b5a.js";import{u as se}from"./useCategory-2a7122fa.js";import{u as ne}from"./useTag-b6027871.js";import{s as D}from"./pinia-b4aeb200.js";import{r as re,a as ie}from"./articleApi-ee83a0ae.js";import{a as ue}from"./axios-f45f83e3.js";import{f as I,L as P,r as E,o as de,a7 as u,$ as w,a0 as S,c as t,a9 as l,u as o,K as d,a1 as q,a6 as A,F as R,J as p,V as me,a4 as J,a8 as $}from"./@vue-9926d340.js";import{m as x}from"./ant-design-vue-01be3039.js";import"./useFile-fbf1e74d.js";import"./@ant-design-2dc0aa31.js";import"./@ctrl-7f4e908e.js";import"./mitt-dab1f1cb.js";import"./nprogress-7c12677d.js";import"./@babel-fff5462b.js";import"./vue3-colorpicker-2b62a1f5.js";import"./@vueuse-f8675665.js";import"./tinycolor2-8fe94c9b.js";import"./gradient-parser-8ea7f2ac.js";import"./@aesoper-129a60c8.js";import"./lodash-es-6d6f457b.js";import"./@popperjs-898015e8.js";import"./vue-demi-5b9a0fa5.js";import"./resize-observer-polyfill-c24c855f.js";import"./vue-types-932461d1.js";import"./dom-align-de4ed2f2.js";import"./dayjs-332804ad.js";import"./async-validator-efc2d198.js";import"./scroll-into-view-if-needed-90d8f7af.js";import"./compute-scroll-into-view-72df79c3.js";const pe={class:"write-page"},ce={class:"top"},ve={class:"title"},fe={class:"content"},_e={__name:"WriteArticle",setup(ge){const j=ae(),s=te().params,O=se(),N=ne(),{categoryList:K,loading:M}=D(O),{tagList:z,loading:G}=D(N),H=I({h1:"\u65B0\u6587\u7AE0",title:"",content:""}),{h1:T,title:c,content:v}=P(H),V=I({visible:!1,uploading:!1,status:"\u516C\u5F00",belongTo:"",bgImg:"",selectedTag:[],layout:{labelCol:{span:3},wrapperCol:{span:21}},description:""}),{visible:f,uploading:U,status:_,belongTo:g,selectedTag:b,bgImg:y,description:k}=P(V),W=E(null),C={async handleOk(){try{await W.value.validate();const n=T.value==="\u65B0\u6587\u7AE0"?re:ie,a={status:_.value,title:c.value,content:v.value,belongTo:g.value,tags:Object.values(b.value),bgImg:y.value,description:k.value};T.value!=="\u65B0\u6587\u7AE0"&&(a.id=s.id),U.value=!0;const r=await n(a);U.value=!1,r.code===1?(x.success(r.message),f.value=!1,j.push("/articles")):x.error(r.message)}catch{}},handleCancel(){f.value=!1},showUploadDialog(){if(c.value===""){x.error("\u8BF7\u5148\u586B\u5199\u6807\u9898");return}if(v.value===""){x.error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9");return}f.value=!0},onFinish(n){},onFinishFailed(n){}},Q=async(n,a)=>{const r=await Promise.all(n.map(i=>new Promise((F,m)=>{const L=new FormData;L.append("file",i),oe.post("/api/file/upload",L,{headers:{"Content-Type":"multipart/form-data"}}).then(h=>F(h)).catch(h=>m(h))})));a(r.map(i=>i.data.url))},B=E(!1);return de(async()=>{if(JSON.stringify(s)!=="{}"){T.value="\u7F16\u8F91\u6587\u7AE0",B.value=!0;const n=await ue.get(s.content_url);B.value=!1,v.value=n.data+"",await O.getCategoryList(),await N.getTagList(),c.value=s.title,_.value=s.status,g.value=s.belong_to,y.value=s.bg_img,b.value=s.tag_list,k.value=s.description}}),(n,a)=>{const r=u("a-button"),i=u("a-select-option"),F=u("a-select"),m=u("a-form-item"),L=u("a-textarea"),h=u("a-form"),X=u("a-modal"),Y=u("a-input");return w(),S(R,null,[t(X,{visible:o(f),"onUpdate:visible":a[5]||(a[5]=e=>d(f)?f.value=e:null),title:"\u4E0A\u4F20\u6587\u7AE0"},{footer:l(()=>[t(r,{key:"back",onClick:C.handleCancel,disabled:o(U)},{default:l(()=>[p("\u53D6\u6D88")]),_:1},8,["onClick","disabled"]),t(r,{key:"submit",type:"primary",loading:o(U),onClick:C.handleOk},{default:l(()=>[p("\u4E0A\u4F20")]),_:1},8,["loading","onClick"])]),default:l(()=>[t(h,me({ref_key:"ruleForm",ref:W,model:V},V.layout,{name:"upload-info",onFinish:C.onFinish,onFinishFailed:C.onFinishFailed,autocomplete:"off"}),{default:l(()=>[t(m,{name:"status",label:"\u72B6\u6001",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u53D1\u5E03\u72B6\u6001"}]},{default:l(()=>[t(F,{ref:"select",value:o(_),"onUpdate:value":a[0]||(a[0]=e=>d(_)?_.value=e:null)},{default:l(()=>[t(i,{value:"\u516C\u5F00"},{default:l(()=>[p("\u516C\u5F00")]),_:1}),t(i,{value:"\u79C1\u5BC6"},{default:l(()=>[p("\u79C1\u5BC6")]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{name:"bgImg",label:"\u80CC\u666F",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u80CC\u666F\u56FE"}]},{default:l(()=>[t(ee,{fileName:o(y),"onUpdate:fileName":a[1]||(a[1]=e=>d(y)?y.value=e:null)},null,8,["fileName"])]),_:1}),t(m,{name:"belongTo",label:"\u5206\u7C7B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B"}]},{default:l(()=>[t(F,{ref:"select",value:o(g),"onUpdate:value":a[2]||(a[2]=e=>d(g)?g.value=e:null),placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",loading:o(M),onClickOnce:o(O).getCategoryList},{default:l(()=>[(w(!0),S(R,null,J(o(K),e=>(w(),$(i,{value:e.id,key:e.id},{default:l(()=>[p(A(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","onClickOnce"])]),_:1}),t(m,{name:"selectedTag",label:"\u6807\u7B7E",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",type:"array"}]},{default:l(()=>[t(F,{value:o(b),"onUpdate:value":a[3]||(a[3]=e=>d(b)?b.value=e:null),mode:"multiple",placeholder:"\u9009\u62E9\u6807\u7B7E",loading:o(G),onClickOnce:o(N).getTagList},{default:l(()=>[(w(!0),S(R,null,J(o(z),e=>(w(),$(i,{value:e.id,key:e.id},{default:l(()=>[p(A(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","onClickOnce"])]),_:1}),t(m,{name:"description",label:"\u7B80\u4ECB",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7B80\u4ECB"}]},{default:l(()=>[t(L,{value:o(k),"onUpdate:value":a[4]||(a[4]=e=>d(k)?k.value=e:null),rows:4},null,8,["value"])]),_:1})]),_:1},16,["model","onFinish","onFinishFailed"])]),_:1},8,["visible"]),q("div",pe,[q("div",ce,[q("h1",ve,A(o(T)),1),t(r,{type:"primary",class:"upload-btn",onClick:C.showUploadDialog},{default:l(()=>[p("\u4E0A\u4F20")]),_:1},8,["onClick"])]),q("div",fe,[t(Y,{placeholder:"\u8F93\u5165\u6587\u7AE0\u6807\u9898",value:o(c),"onUpdate:value":a[6]||(a[6]=e=>d(c)?c.value=e:null)},null,8,["value"]),t(o(Z),{modelValue:o(v),"onUpdate:modelValue":a[7]||(a[7]=e=>d(v)?v.value=e:null),class:"mt",onOnUploadImg:Q},null,8,["modelValue"])])])],64)}}};var Xe=le(_e,[["__scopeId","data-v-703050d4"]]);export{Xe as default};
